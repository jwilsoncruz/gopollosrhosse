<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pollos a la le√±a - Go Pollos Rhosse - Trinidad, Bolivia</title>
<link rel="icon" href="favicon.ico">

<style>
body{
 font-family: Arial, sans-serif;
 margin:0;
 background:#610000;
 padding-bottom:240px;
}

header{
 text-align:center;
 padding:40px 20px;
 background:#d50000;
 color:white;
}

.logo{
 max-width:200px;
 display:block;
 margin:0 auto 15px auto;
}

.container{ padding:20px; }

.categoria{
 margin-top:35px;
 font-size:22px;
 color:#d50000;
}

.grid{
 display:grid;
 grid-template-columns:repeat(auto-fit,minmax(170px,1fr));
 gap:15px;
}

.card{
 background:white;
 padding:15px;
 border-radius:14px;
 box-shadow:0 6px 16px rgba(0,0,0,0.08);
 text-align:center;
}

.card img{
 width:100%;
 height:120px;
 object-fit:cover;
 border-radius:10px;
}

.precio{ font-weight:bold; margin:8px 0; }

.boton{
 background:#25D366;
 color:white;
 padding:8px;
 border:none;
 border-radius:8px;
 cursor:pointer;
 font-weight:bold;
}

.boton:disabled{
 background:gray;
 cursor:not-allowed;
}

.carrito{
 position:fixed;
 bottom:0;
 left:0;
 right:0;
 background:white;
 box-shadow:0 -3px 10px rgba(0,0,0,0.1);
 padding:15px;
}

.total{ font-weight:bold; font-size:18px; }

.cocina-card{
 background:white;
 margin:15px;
 padding:15px;
 border-left:6px solid #d50000;
 border-radius:10px;
 box-shadow:0 4px 10px rgba(0,0,0,0.1);
}

.estado-btn{
 margin-top:8px;
 background:#d50000;
 color:white;
 border:none;
 padding:6px 10px;
 border-radius:6px;
 cursor:pointer;
}
</style>
</head>

<body>

<div id="app"></div>

<script>

const params = new URLSearchParams(window.location.search);
const modo = params.get("modo");

// ================== CONFIGURACI√ìN HORARIO ==================
const aperturaHora = 18;
const aperturaMin = 30;
const cierreHora = 22;
const cierreMin = 30;

const totalPollos = 8;
let pollosDisponibles = 8; // üî• CAMBIA CADA NOCHE

// ================== MODO COCINA ==================
if(modo === "cocina"){

document.getElementById("app").innerHTML = `
<header><h1>üçó PANTALLA COCINA</h1></header>
<div style="text-align:center;padding:20px;">
<button onclick="activarSonido()" 
style="padding:15px 25px;font-size:18px;background:#d50000;color:white;border:none;border-radius:10px;">
üîî Activar sonido cocina
</button>
</div>
<div id="listaPedidos"></div>
<audio id="alerta" preload="auto">
<source src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" type="audio/ogg">
</audio>
`;

let sonidoActivado=false;

function activarSonido(){
 sonidoActivado=true;
 alert("Sonido activado üîî");
}

function cargarPedidos(){
 let pedidos=JSON.parse(localStorage.getItem("pedidos"))||[];
 let html="";
 pedidos.forEach((p,i)=>{
   if(p.estado!=="Entregado"){
     html+=`
     <div class="cocina-card">
       <h3>Mesa ${p.mesa}</h3>
       <p>${p.detalle}</p>
       <strong>Total: Bs ${p.total}</strong><br>
       Estado: ${p.estado}<br>
       <button class="estado-btn" onclick="cambiarEstado(${i})">
       Cambiar Estado
       </button>
     </div>`;
   }
 });
 document.getElementById("listaPedidos").innerHTML=html;
}

function cambiarEstado(i){
 let pedidos=JSON.parse(localStorage.getItem("pedidos"))||[];
 let p=pedidos[i];
 if(p.estado==="Nuevo") p.estado="En preparaci√≥n";
 else if(p.estado==="En preparaci√≥n") p.estado="Listo";
 else p.estado="Entregado";
 pedidos[i]=p;
 localStorage.setItem("pedidos",JSON.stringify(pedidos));
 cargarPedidos();
}

let ultimoTotal=0;
setInterval(()=>{
 let pedidos=JSON.parse(localStorage.getItem("pedidos"))||[];
 if(pedidos.length>ultimoTotal){
   if(sonidoActivado) document.getElementById("alerta").play();
   ultimoTotal=pedidos.length;
 }
 cargarPedidos();
},1000);

}

// ================== MODO CLIENTE ==================
else{

document.getElementById("app").innerHTML = `
<header>
<img src="logo.png" class="logo">
<h1>Pollos a la Le√±a - Go Pollos Rhosse</h1>
<p>Av. Moxos - Zona Mercado Pompeya</p>
<div style="background:white;padding:15px;border-radius:12px;margin-top:15px;text-align:center;">
  <img src="promo1sodamini.jpg" style="width:100%;border-radius:10px;">
  <h2 style="color:#d50000;">üî• PROMO DEL MES</h2>
  <button class="boton" onclick="agregar('üî• Promo Cuarto Pollo + Soda Mini',25)">
    Agregar Promo
  </button>
</div>
<!-- ===== ESTADO + ESCACEZ MEJORADO ===== -->
<div style="
  background:white;
  padding:15px;
  border-radius:14px;
  margin-top:15px;
  box-shadow:0 8px 20px rgba(0,0,0,0.25);
">

  <div id="estadoLocal"
       style="
       margin-bottom:10px;
       font-weight:bold;
       font-size:18px;">
  </div>

  <div style="
      background:#f5f5f5;
      border-radius:20px;
      overflow:hidden;
      height:20px;
      margin:10px 0;">
    <div id="barraPollos"
         style="
         height:100%;
         width:100%;
         background:linear-gradient(90deg,#ff4d4d,#b30000);
         transition:0.5s;">
    </div>
  </div>

  <div id="textoEscasez"
       style="
       font-weight:bold;
       font-size:16px;
       color:#b30000;">
  </div>

</div>
</header>

<div class="container">
<h2 class="categoria">üçó Pollos a la le√±a</h2>
<div id="pollos" class="grid"></div>

<h2 class="categoria">ü•§ Bebidas</h2>
<div id="bebidas" class="grid"></div>

<h2 class="categoria">üçî Extras</h2>
<div id="extras" class="grid"></div>
</div>

<div class="carrito">
<div id="resumen">Sin productos</div>
<div class="total" id="total">Total: Bs 0</div>
<button class="boton" onclick="enviarPedido()">Enviar pedido por WhatsApp</button>
</div>
`;

function obtenerMesa(){
 return new URLSearchParams(window.location.search).get("mesa") || "No especificada";
}

const productos=[
{categoria:"pollos", nombre:"Pollo Econ√≥mico", precio:15, img:"menu.jpg"},
{categoria:"pollos", nombre:"Cuarto Pollo", precio:25, img:"medio.jpg"},
{categoria:"pollos", nombre:"Medio Pollo", precio:50, img:"cuarto.jpg"},
{categoria:"pollos", nombre:"Pollo Entero", precio:100, img:"entero.jpg"},
{categoria:"bebidas", nombre:"Gaseosa 2L", precio:12, img:"gaseosa2l.jpg"},
{categoria:"bebidas", nombre:"Gaseosa Personal", precio:6, img:"gaseosa.jpg"},
 {categoria:"bebidas", nombre:"Limonada Jarra media", precio:5, img:"limonada_mediana.jpg"},
 {categoria:"bebidas", nombre:"Limonada Jarra Grande", precio:10, img:"limonada_grande.jpg"},
 {categoria:"bebidas", nombre:"Limonada Vaso", precio:3, img:"limonada_vaso.jpg"},
{categoria:"extras", nombre:"Anticucho", precio:5, img:"anticucho.jpg"},
{categoria:"extras", nombre:"Hamburguesa", precio:15, img:"hamburguesa.jpg"},
{categoria:"extras", nombre:"Extra Platano", precio:5, img:"extra_platano.jpg"},
{categoria:"extras", nombre:"Extra Papas", precio:5, img:"extra_papas.jpg"},
{categoria:"extras", nombre:"Extra Arroz", precio:5, img:"extra_arroz.jpg"}
];


let carrito=[];

function crearProducto(prod){
 const div=document.createElement("div");
 div.className="card";

 let botonHTML="";

 if(prod.promo){
   botonHTML=`<button class="boton" id="btnPromo"
   onclick="agregarPromo('${prod.nombre}',${prod.precio})">
   Agregar
   </button>`;
 }else{
   botonHTML=`<button class="boton"
   onclick="agregar('${prod.nombre}',${prod.precio})">
   Agregar
   </button>`;
 }

 div.innerHTML=`
 <img src="${prod.img}">
 <h3>${prod.nombre}</h3>
 <div class="precio">Bs ${prod.precio}</div>
 ${botonHTML}
 `;
 return div;
}

function cargarProductos(){
 productos.forEach(p=>{
   document.getElementById(p.categoria)
   .appendChild(crearProducto(p));
 });
}

function agregar(nombre,precio){
 carrito.push({nombre,precio});
 actualizarCarrito();
}

function agregarPromo(nombre,precio){
 if(pollosDisponibles<=0) return;
 carrito.push({nombre,precio});
 pollosDisponibles--;
 actualizarCarrito();
 actualizarEscasez();
}

function actualizarCarrito(){
 let resumenHTML="";
 let total=0;
 carrito.forEach(item=>{
   total+=item.precio;
   resumenHTML+=item.nombre+" - Bs "+item.precio+"<br>";
 });
 document.getElementById("resumen").innerHTML=resumenHTML||"Sin productos";
 document.getElementById("total").innerHTML="Total: Bs "+total;
}

function enviarPedido(){
 if(carrito.length===0){alert("Agrega al menos un producto");return;}
 let mensaje="Pedido:\n\n";
 let detalle="";
 let total=0;
 carrito.forEach(item=>{
   mensaje+=item.nombre+" - Bs "+item.precio+"\n";
   detalle+=item.nombre+" - Bs "+item.precio+"<br>";
   total+=item.precio;
 });
 mensaje+="\nTotal: Bs "+total+"\nMesa: "+obtenerMesa();
 let pedidos=JSON.parse(localStorage.getItem("pedidos"))||[];
 pedidos.push({mesa:obtenerMesa(),detalle,total,estado:"Nuevo"});
 localStorage.setItem("pedidos",JSON.stringify(pedidos));
 window.open("https://wa.me/59168972863?text="+encodeURIComponent(mensaje),"_blank");
 carrito=[];
 actualizarCarrito();
}

function actualizarEscasez(){
 const barra=document.getElementById("barraPollos");
 const texto=document.getElementById("textoEscasez");
 const btn=document.getElementById("btnPromo");

 let porcentaje=(pollosDisponibles/totalPollos)*100;
 barra.style.width=porcentaje+"%";

 if(pollosDisponibles>2){
   texto.innerHTML="üî• Disponibles: "+pollosDisponibles+" de "+totalPollos;
 }else if(pollosDisponibles>0){
   texto.innerHTML="‚ö†Ô∏è ¬°√öLTIMOS "+pollosDisponibles+" POLLOS!";
   barra.style.background="orange";
 }else{
   texto.innerHTML="‚ùå PROMOCI√ìN AGOTADA";
   barra.style.background="gray";
   if(btn){btn.disabled=true;btn.innerText="Agotado";}
 }
}

function actualizarEstado(){
 const ahora=new Date();
 const dia=ahora.getDay();
 const hora=ahora.getHours();
 const min=ahora.getMinutes();
 const estado=document.getElementById("estadoLocal");

 const abierto=
 dia>=1&&dia<=6&&
 ((hora>aperturaHora||(hora===aperturaHora&&min>=aperturaMin))&&
 (hora<cierreHora||(hora===cierreHora&&min<=cierreMin)));

 if(abierto){
   estado.innerHTML="üü¢ Estamos ABIERTOS hasta 10:30 PM";
   estado.style.color="green";
 }else{
   let proxima=new Date();
   proxima.setHours(aperturaHora,aperturaMin,0);
   if(hora>cierreHora||dia===0) proxima.setDate(proxima.getDate()+1);
   let diff=proxima-ahora;
   let h=Math.floor(diff/(1000*60*60));
   let m=Math.floor((diff%(1000*60*60))/(1000*60));
   estado.innerHTML="üî¥ Cerrado ‚Äî Abrimos en "+h+"h "+m+"m";
   estado.style.color="red";
 }
}

setInterval(actualizarEstado,60000);
actualizarEstado();
cargarProductos();
actualizarEscasez();

}

</script>

</body>
</html>
